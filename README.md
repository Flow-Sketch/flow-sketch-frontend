# **1ï¸âƒ£ í”„ë¡œì íŠ¸ ì†Œê°œ** 

ì´ í”„ë¡œì íŠ¸ëŠ” ì›¹ ê¸°ë°˜ì˜ ìº”ë²„ìŠ¤ ë“œë¡œì‰ ì—ë””í„°ë¡œ, ì‚¬ìš©ìê°€ ë‹¤ì–‘í•œ ë„í˜•ì„ ìƒì„±í•˜ê³ , ì„ íƒí•˜ê³ , ì´ë™í•˜ê³ , í¬ê¸°ë¥¼ ì¡°ì ˆí•˜ê³ , ì‚­ì œí•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.

Figmaë‚˜ Draw.ioì™€ ê°™ì€ ë””ìì¸/ë‹¤ì´ì–´ê·¸ë¨ ë„êµ¬ì™€ ìœ ì‚¬í•œ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë©°, ë‹¤ì¤‘ ì ‘ì†ìœ¼ë¡œ ë™ì‹œ í¸ì§‘ì´ ê°€ëŠ¥í•œ ê¸°ëŠ¥ ì œê³µì„ ëª©í‘œë¡œ í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í–ˆìŠµë‹ˆë‹¤.

> ##### ì„œë¹„ìŠ¤ ë§í¬
> [http://www.flowsketch.kr](http://www.flowsketch.kr)

# **2ï¸âƒ£ ì£¼ìš”ê¸°ëŠ¥**

### ìº”ë²„ìŠ¤ í¸ì§‘ ë° ìƒì„±

> ìº”ë²„ìŠ¤ì—ì„œ ì‚¬ìš©ìëŠ” ë‹¤ì–‘í•œ ë„í˜•ì„ ììœ ë¡­ê²Œ ê·¸ë¦¬ê³  í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> ë„í˜•ì„ ìƒì„±í•˜ê³ , ì„ íƒí•˜ì—¬ ì´ë™í•˜ê±°ë‚˜ í¬ê¸°ë¥¼ ì¡°ì ˆí•  ìˆ˜ ìˆìœ¼ë©°, í•„ìš”í•œ ê²½ìš° ì‚­ì œí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

- **ë„í˜• ìƒì„±**: ì‚¬ê°í˜•, íƒ€ì› ë“± ë‹¤ì–‘í•œ ë„í˜•ì„ ìº”ë²„ìŠ¤ì— ìƒì„±
- **ìš”ì†Œ ì„ íƒ**: ë‹¨ì¼ ë˜ëŠ” ë‹¤ì¤‘ ìš”ì†Œ ì„ íƒ ê¸°ëŠ¥
- **ìš”ì†Œ ì´ë™**: ì„ íƒí•œ ìš”ì†Œë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì´ë™
- **ìš”ì†Œ í¬ê¸° ì¡°ì ˆ**: ì„ íƒí•œ ìš”ì†Œì˜ í¬ê¸°ë¥¼ í•¸ë“¤ì„ í†µí•´ ì¡°ì ˆ
- **ìš”ì†Œ ì‚­ì œ**: ì„ íƒí•œ ìš”ì†Œë¥¼ í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ë¡œ ì‚­ì œ
- **ìº”ë²„ìŠ¤ ë·° ì¡°ì‘**: í™•ëŒ€/ì¶•ì†Œ ë° ì´ë™ ê¸°ëŠ¥

### ë™ì‹œí¸ì§‘

> ##### ğŸš€ ì¶”í›„ ê°œë°œ ì˜ˆì •
> ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ë™ì‹œì— ê°™ì€ ìº”ë²„ìŠ¤ë¥¼ í¸ì§‘í•  ìˆ˜ ìˆëŠ” ì‹¤ì‹œê°„ í˜‘ì—… ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤.  
> ê° ì‚¬ìš©ìì˜ í¸ì§‘ ë‚´ìš©ì´ ì¦‰ì‹œ ë‹¤ë¥¸ ì‚¬ìš©ìì—ê²Œ ë°˜ì˜ë©ë‹ˆë‹¤.

- ì‹¤ì‹œê°„ ì»¤ì„œ ë° ì„ íƒ ì˜ì—­ í‘œì‹œë¡œ ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ì‘ì—… ìƒíƒœë¥¼ í™•ì¸ ê°€ëŠ¥
- ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•œ ì‘ì—… ë‹¨ìœ„ë³„ ë½(Lock) ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„
- ë³€ê²½ ì‚¬í•­ì— ëŒ€í•œ ì‹¤ì‹œê°„ ë™ê¸°í™” ë° ì˜êµ¬ ì €ì¥

# **3ï¸âƒ£Â ì•„í‚¤í…ì²˜ ê°œìš”**

## **âœ…**Â ë‹¨ì–´ ì •ë¦¬

### 1. `elementRegistry`

`elementRegistry`ëŠ” ìº”ë²„ìŠ¤ì˜ ëª¨ë“  ìš”ì†Œë“¤ì„ ê´€ë¦¬í•˜ëŠ” ì¤‘ì•™ ì €ì¥ì†Œ ì—­í• ì„ í•˜ë©°, ë‹¤ìŒê³¼ ê°™ì€ ë‘ ê°€ì§€ í•µì‹¬ ë°ì´í„° êµ¬ì¡°ë¥¼ í¬í•¨í•œë‹¤.

```tsx
export interface ElementRegistry {
  elements: {
    [id: string]: EllipseSketchElement | RectSketchElement;
  };
  layerOrder: string[];
}
```

- **elements**:
  - ê° ìš”ì†Œì˜ IDë¥¼ í‚¤ë¡œ í•˜ê³ , í•´ë‹¹ ìš”ì†Œì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°’ìœ¼ë¡œ ê°€ì§€ëŠ” ê°ì²´.
  - ê° ìš”ì†ŒëŠ” ìœ„ì¹˜, í¬ê¸°, íšŒì „ ë“±ì˜ ì†ì„±ì„ í¬í•¨.
- **layerOrder**:
  - ìš”ì†Œë“¤ì˜ IDë¥¼ ë°°ì—´ë¡œ ì €ì¥í•˜ì—¬ ë Œë”ë§ ìˆœì„œ(z-index)ë¥¼ ê´€ë¦¬

### 2. `Store`

`store`ëŠ” ìº”ë²„ìŠ¤ì˜ ìƒíƒœì™€ ë°ì´í„°ë¥¼ ê´€ë¦¬í•˜ëŠ” ì¤‘ì•™ ì €ì¥ì†Œì´ë‹¤.

`store` ëŠ” ê°ê°ì˜ Manager Hook ë“¤ê³¼ ê¸´ë°€í•˜ê²Œ ì—°ê³„ë˜ì–´ ë™ì‘í•˜ë©°, Manager Hookë“¤ì€ storeì˜ íŠ¹ì • ë¶€ë¶„ì„ ë‹´ë‹¹í•˜ì—¬ ê´€ë¦¬í•˜ëŠ” ì—­í• ì„ í•œë‹¤.

### 3. `Manager (Hook)`

Manager Hookì€ React ì»¤ìŠ¤í…€ í›…ìœ¼ë¡œ, ìº”ë²„ìŠ¤ì˜ ê° ê¸°ëŠ¥ì„ ë…ë¦½ì ìœ¼ë¡œ ê´€ë¦¬í•œë‹¤.

Manager ì—ì„œëŠ” store ë¥¼ ê´€ë¦¬í•˜ëŠ” Hook ìœ¼ë¡œ ë¶„ë¦¬ë˜ë©°, ê°ê°ì˜ Manager Hookì€ store ë‚´ì—ì„œ íŠ¹ì • ê¸°ëŠ¥(ì˜ˆ: ì„ íƒ, ì´ë™, í¬ê¸° ì¡°ì ˆ ë“±)ì— ëŒ€í•œ ìƒíƒœì™€ ë¡œì§ì„ ê°œë³„ë¡œ ê´€ë¦¬í•˜ê³  í•„ìš”í•œ ê¸°ëŠ¥ì„ ì œê³µ.

```mermaid
graph TD
    Store[Store] --> Manager[Manager Hook]
    Manager --> |Execute| Handler1[Event Handler 1]
    Manager --> |Execute| Handler2[Event Handler 2]
    Manager --> |Execute| Handler3[Event Handler 3]

```

ì˜ˆë¥¼ë“¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤.

- **useCanvasElementRegistry**: ìš”ì†Œë“¤ì˜ ìƒì„±, ìˆ˜ì •, ì‚­ì œì™€ ê´€ë ¨ëœ store ìƒíƒœë¥¼ ê´€ë¦¬
- **useCanvasSelectManager**: ìš”ì†Œ ì„ íƒ ìƒíƒœì™€ ê´€ë ¨ëœ store ë¶€ë¶„ì„ ê´€ë¦¬
- **useCanvasMoveElementManager**: ìš”ì†Œ ì´ë™ê³¼ ê´€ë ¨ëœ ìƒíƒœë¥¼ storeì—ì„œ ê´€ë¦¬

## **âœ…Â í•µì‹¬ ì»´í¬ë„ŒíŠ¸**

### **Canvas ì»´í¬ë„ŒíŠ¸**

> Canvas ì»´í¬ë„ŒíŠ¸ëŠ” ëª¨ë“  ë“œë¡œì‰ ê¸°ëŠ¥ì´ êµ¬í˜„ë˜ëŠ” ë©”ì¸ ì»´í¬ë„ŒíŠ¸ì…ë‹ˆë‹¤.  
> ë‹¤ì–‘í•œ í›…ì„ í†µí•©í•˜ì—¬ ì‚¬ìš©ì ì¸í„°ë™ì…˜ì„ ì´ ê³³ì—ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
> `useCanvasActionHandler` ë¥¼ í†µí•´ ë‹¤ì–‘í•œ ì•¡ì…˜ í•¸ë“¤ëŸ¬ë¥¼ í†µí•©í•˜ê³ , `usePaintingCanvas` ë¥¼ í†µí•´ ìº”ë²„ìŠ¤ì— ìš”ì†Œë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.

```tsx
export const Canvas = () => {
  const { canvasRef } = useCanvas();
  const { viewState, viewAction } = useCanvasViewManager();
  const { elementRegistry, elementRegistryAction } = useCanvasElementRegistry();
  const { selectState, selectAction } = useCanvasSelectManager(elementRegistry, viewState);
  const { createState, createAction } = useCanvasCreateElementManger(viewState, elementRegistryAction);
  const { deleteAction } = useCanvasDeleteElementManager(selectState, selectAction, elementRegistryAction);
  const { moveAction } = useCanvasMoveElementManager(viewState, selectState, elementRegistryAction);
  const { resizeAction } = useCanvasResizeElementManager(viewState, selectState, elementRegistryAction);

  const handler = useCanvasActionHandler(selectState, viewAction, selectAction, createAction, deleteAction, moveAction, resizeAction);
  usePaintingCanvas(canvasRef, elementRegistry, viewState, selectState, createState);

  // ë Œë”ë§ ë¡œì§...
};
```

## **âœ… ì£¼ìš” ëª¨ë¸**

### 1. `BaseSketchElement`

> ëª¨ë“  ìº”ë²„ìŠ¤ ìš”ì†Œì˜ ê¸°ë³¸ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.  
> ìœ„ì¹˜, í¬ê¸°, íšŒì „ ë“±ì˜ ê³µí†µ ì†ì„±ê³¼ ë©”ì†Œë“œë¥¼ ì œê³µí•˜ë©°, resize ë©”ì†Œë“œë¥¼ í†µí•´ ìš”ì†Œ í¬ê¸° ì¡°ì ˆ ê¸°ëŠ¥ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

```tsx
export abstract class BaseSketchElement {
  /**
   * ìš”ì†Œì˜ í¬ê¸°ì™€ ìœ„ì¹˜ë¥¼ ì¡°ì •í•˜ëŠ” ë©”ì†Œë“œ
   *
   * @param dx - Xì¶• ë°©í–¥ìœ¼ë¡œì˜ ë§ˆìš°ìŠ¤ ì´ë™ëŸ‰
   * @param dy - Yì¶• ë°©í–¥ìœ¼ë¡œì˜ ë§ˆìš°ìŠ¤ ì´ë™ëŸ‰
   * @param directions - ë¦¬ì‚¬ì´ì¦ˆê°€ ì‹œì‘ëœ ë°©í–¥ë“¤ (top, right, bottom, left)
   */
  resize(dx: number, dy: number, directions: ('top' | 'right' | 'bottom' | 'left')[]) {
    const adjustedDeltaX = directions.includes('left') ? -dx : directions.includes('right') ? dx : 0;
    const adjustedDeltaY = directions.includes('top') ? -dy : directions.includes('bottom') ? dy : 0;
    const deltaX = !directions.includes('left') && !directions.includes('right') ? 0 : dx;
    const deltaY = !directions.includes('top') && !directions.includes('bottom') ? 0 : dy;

    const newWidth = Math.max(this.width + adjustedDeltaX, 10);
    const newHeight = Math.max(this.height + adjustedDeltaY, 10);
    const newX = this.x + deltaX / 2;
    const newY = this.y + deltaY / 2;

    this.x = newX;
    this.y = newY;
    this.width = newWidth;
    this.height = newHeight;
  }
}
```

### 2. `CanvasBoard`

> `CanvasBoard`ëŠ” ìº”ë²„ìŠ¤ì˜ ë©”íƒ€ë°ì´í„°ì™€ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ëª¨ë“ˆì…ë‹ˆë‹¤:

```typescript
interface CanvasBoardState {
  canvasList: CanvasMetadata[];
}

interface CanvasMetadata {
  id: string;
  name: string;
  description: string;
  createdAt: string;
  updatedAt: string;
  createdBy: string;
  lastModifiedBy: string;
  isPublic: boolean;
  version: number;
}
```

## **âœ… ì¢Œí‘œê³„ ì‹œìŠ¤í…œ**

í”„ë¡œì íŠ¸ëŠ” ë‘ ê°€ì§€ ì¢Œí‘œê³„ê°€ ì ìš©ë˜ì–´ìˆë‹¤.

- **ë·° ì¢Œí‘œê³„**: í™”ë©´ì— ë³´ì´ëŠ” ì¢Œí‘œ (ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ì—ì„œ ì–»ëŠ” ì¢Œí‘œ)
- **ì ˆëŒ€ ì¢Œí‘œê³„**: ì‹¤ì œ ìš”ì†Œì˜ ìœ„ì¹˜ì™€ í¬ê¸°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì¢Œí‘œ

ì¢Œí‘œê³„ ë³€í™˜ ì˜ˆì‹œ:

```tsx
// ë·° ì¢Œí‘œê³„ â†’ ì ˆëŒ€ ì¢Œí‘œê³„ ë³€í™˜
const convertWidth = Math.abs(endPoint.x - startPoint.x) / viewState.scale;
const convertHeight = Math.abs(endPoint.y - startPoint.y) / viewState.scale;
const convertOffsetX = (Math.abs(viewState.offset.x) + Math.min(startPoint.x, endPoint.x)) / viewState.scale;
const convertOffsetY = (Math.abs(viewState.offset.y) + Math.min(startPoint.y, endPoint.y)) / viewState.scale;
```

# 4ï¸âƒ£Â ì¼ì • ê´€ë¦¬ ë° ê°œì„ ë°©í–¥

## Github í”„ë¡œì íŠ¸ ê´€ë¦¬

[flow-sketch â€¢ IceBear9028](https://github.com/users/IceBear9028/projects/1)

## **ìµœê·¼ ì¶”ê°€ëœ ê¸°ëŠ¥**

- [x] **ìº”ë²„ìŠ¤ ë©”íƒ€ë°ì´í„° ê´€ë¦¬**: ì´ë¦„ ë³€ê²½, ë©”ëª¨ ì¶”ê°€ ê¸°ëŠ¥ êµ¬í˜„
- [x] **ì‚¬ìš©ì ì¤‘ì‹¬ URL êµ¬ì¡°**: URL ì²´ê³„ë¥¼ ì‚¬ìš©ì ì¤‘ì‹¬ìœ¼ë¡œ ì¬êµ¬ì„±
- [x] **ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë™ê¸°í™”**: ìº”ë²„ìŠ¤ ë°ì´í„° ìë™ ì €ì¥ êµ¬í˜„
- [x] **ìº”ë²„ìŠ¤ ëª©ë¡ ê´€ë¦¬**: ì‹œê°„ìˆœ ì •ë ¬ ë° í•„í„°ë§ ê¸°ëŠ¥ ì¶”ê°€

## **ë‹¤ìŒ ê°œì„  ê³„íš**

[ê¸°ì¡´ ê°œì„  ë°©í–¥ì— ì¶”ê°€:]

- [ ] **ìº”ë²„ìŠ¤ ê³µìœ  ê¸°ëŠ¥**: ë‹¤ë¥¸ ì‚¬ìš©ìì™€ ìº”ë²„ìŠ¤ ê³µìœ  ê¸°ëŠ¥ êµ¬í˜„
- [ ] **ì‹¤ì‹œê°„ í˜‘ì—…**: ì—¬ëŸ¬ ì‚¬ìš©ìì˜ ë™ì‹œ í¸ì§‘ ê¸°ëŠ¥ êµ¬í˜„
- [ ] **íˆìŠ¤í† ë¦¬ ê´€ë¦¬**: ìº”ë²„ìŠ¤ ë³€ê²½ ì´ë ¥ ê´€ë¦¬ ê¸°ëŠ¥ ì¶”ê°€
